- first_signs_count = 300
- if local_assigns[:widget]
  - local_assigns[:limit_signs_count] = 10
  - local_assigns[:hide_users] = params[:hide_users].present? ? (params[:hide_users] == 'true') : true

.sign-panel
  - if user_signed_in? and petition.signed?(current_user)
    .sign-panel__form
      .alert.alert-warning
        .text-center
          참여하였습니다
  - else
    .sign-panel__form
      .alert.alert-warning
        - if user_signed_in? and petition.signed?(current_user)
        - else
          = form_for Sign.new(petition: petition) do |f|
            = f.hidden_field :petition_id
            - unless user_signed_in?
              .form-group
                = f.label :signer_name
                = f.text_field :signer_name, placeholder: '홍길동', class: 'form-control'
              .form-group.hidden
                = f.label :signer_email
                = f.text_field :signer_email, placeholder: '이메일', class: 'form-control'

            - if petition.id == 29
              .form-group
                = f.label :extra_29_confirm_join
                = f.check_box :extra_29_confirm_join, class: 'form-control'

            .form-group
              = f.label :body, petition.sign_title || Sign.human_attribute_name(:body)
              = f.text_field :body, placeholder: '나는...', class: 'form-control input-lg'
            .form-group
              = f.submit "#{petition.signs_count+1}번째로 참가하기", class: 'btn btn-warning btn-lg btn-block', data: { disable_with: "진행 중...", confirm: '작성을 마치셨습니까' }

  - if petition.signs_goal_count > 0
    .sign-panel__status
      .sign-panel__status__count
        현재
        = petition.signs_count
        \/
        목표
        = petition.signs_goal_count

      .progress
        .progress-bar.progress-bar-warning.progress-bar-striped.active{"aria-valuemax" => "100", "aria-valuemin" => "0", "aria-valuenow" => "#{petition.percentage}", :role => "progressbar", :style => "width: #{petition.percentage}%;"}
          #{petition.percentage}%

  - if petition.signs_count > 0
    - if !local_assigns[:hide_users]
      .sign-panel__users
        %h4 참여자
        %div
          - petition.signs.limit(first_signs_count).each do |sign|
            = image_tag 'icon-candle.png', width: 20, height: 20, class: 'img-circle'
            = sign.user_name
          - if petition.signs.count > first_signs_count
            - if local_assigns[:widget]
              = link_to "... #{petition.signs.count - first_signs_count}명 더보기", petition_url(@petition), target: '_blank'
            - else
              = link_to "... #{petition.signs.count - first_signs_count}명 더보기", petition_signs_path(petition)

    .sign-panel__list
      - signs = @signs.recent
      - signs = signs.limit(local_assigns[:limit_signs_count]) if local_assigns[:limit_signs_count].present?
      - signs.each do |sign|
        %div
          %span.text-primary= sign.user_name
          = raw(screened(sign, :body))
          - if sign.extra_29_confirm_join
            %strong (광고에 참여)
          - if !local_assigns[:widget]
            %small
              - if current_user != sign.user
                = render 'reports/button', reportable: sign
              - if can? :update, sign
                = link_to '수정', [:edit, sign]
              - if can? :destroy, sign
                = link_to '취소', sign, method: :delete, data: { confirm: '정말 취소하시겠습니까?' }
      - if !local_assigns[:widget]
        = paginate @signs, params: { controller: :petitions, action: :show }
      - else
        .text-center{ style: 'margin-top: 12px' }
          = link_to '더보기 >', petition_url(@petition), target: '_blank'

