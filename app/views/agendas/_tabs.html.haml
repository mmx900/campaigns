%section.page-block
  .container
    .page-header
      %h2
        주요 의제
        %span.text-danger #{agendas.count}
        개
    .nav-tabs{ style: 'border:0' }
      - agendas.each_with_index do |agenda, i|
        %div{ style: 'padding:0 10px 10px 0; display: inline-block;' }
          %a{ href: "#agenda_#{i}", role: "tab", data: { toggle: "tab" }}
            .card{ style: 'margin-bottom:0' }
              .card-image{ style: "position: relative; width: 100px; height: 100px; background-image: linear-gradient(rgba(0,0,0,0),rgba(0,0,0,.5)), url(#{agenda.image.sm.url}); background-size: cover; background-position: center center; text-align:center; color: white;" }
                %h5{ style: 'position:absolute; left:0; right:0; bottom:0; '}= agenda.name

%section.page-block
  .container
    .tab-content{ style: 'border:0; padding:0' }
      - agendas.each_with_index do |agenda, i|
        .tab-pane{ id: "agenda_#{i}", class: ('active' if i == 0) }
          .page-header
            %h2= agenda.name
          - issues = params[:theme_tag].present? ? agenda.issues.with_theme(params[:theme_tag]) : agenda.issues
          - issues.each do |issue|
            %section{ style: 'margin-bottom: 3em;' }
              %h3[issue]
                = issue.title

                - if user_signed_in? and current_user.is_admin?
                  .pull-right.hidden-sm.hidden-xs
                    = form_tag new_or_edit_admin_opinions_path, method: :get, class: 'form-inline', target: '_blank' do
                      .inline.field
                        = hidden_field_tag :issue_id, issue.id
                        %select{name: :speaker_id, class: 'form-control'}
                          - speakers.each do |speaker|
                            %option{ value: speaker.id }
                              = speaker.name
                        %button.btn.btn-default{ type: "submit" } 입력

              - if issue.body.present?
                .issue-body
                  %p!= simple_format(h(issue.body))

              - if issue.has_stance?
                - speaker_positions.each do |position|
                  - speakers_of_position = speakers.of_position(position)
                  - if issue.has_any_stances?(speakers_of_position)
                    = render 'opinions/stances', position: (position if speaker_positions.count > 1), speakers: speakers_of_position, issue: issue, theme_tag: params[:theme_tag]

              - if issue.opinions.where(speaker: speakers).any?(&:has_content?)
                .panel.panel-default
                  .list-group
                    - speakers.shuffle.each do |speaker|
                      - issue.opinions.of_speaker(speaker).each do |opinion|
                        - next unless opinion.has_content?
                        = render 'opinions/line_item', opinion: opinion, theme_tag: params[:theme_tag]
