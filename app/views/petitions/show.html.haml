- cover_image = @petition.cover_image_url(:lg)

= render 'petitions/header', petition: @petition, show_agents: true

%section#petition-block.page-block.page-block-white
  .container-fluid
    .petition-body
      = raw @petition.body

      %section.m-t
        %a{id: "anchor-sign"}
        %h4
          서명하기
        .panel-body.component-box
          - if !@petition.sign_hidden
            .panel-post__signs
              = render 'signs/list', petition: @petition

          - else
            .help-text
              #{@petition.signs_count}명이 서명했습니다.
              %br
              %span.text-muted 개설자가 서명 목록을 숨겼습니다.

      %section.m-t
        %h4 이 이슈를 친구들에게 알려 주세요
        .panel-body.component-box
          .share-box{ 'data-share-image': image_url(cover_image)}
          .row
            .col-sm-12
              .input-group
                .input-group-btn
                  .btn.btn-default 위젯 복사
                %input.form-control{ value: "<iframe width='100%' height='800' src='#{petition_url(@petition, mode: :widget)}' frameborder='0'></iframe>" }

      - if @petition.comment_enabled
        %section.m-t
          %h4
            - desc_doms = []
            - @petition.total_action_assignables.each do |action_assignable|
              - desc_doms << capture do
                - if action_assignable.section_title_as_action_assignable.present?
                  = link_to action_assignable do
                    = action_assignable.section_title_as_action_assignable
            - desc_doms.compact!
            != t('views.comment.form_title.petition', desc: desc_doms.join(', '))
          .panel-body.post-block.component-box.panel-comments
            .panel-post__comments
              = render 'comments/list', commentable: @petition

- if flash[:sign_notice].present?
  #sign-success-modal.modal.fade{:role => "dialog", :tabindex => "0"}
    .modal-dialog{:role => "document"}
      .modal-content
        .modal-header
          %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
            %span{"aria-hidden" => "true"} &#215;
          %h4.modal-title
            서명에 참여해주셔서 감사합니다.
        .modal-body
          != flash[:sign_notice]
          .share-box{ 'data-share-image': image_url(cover_image) }
          - if @petition.agents.any?
            - agent_section_title = @petition.agent_section_title.presence || I18n.t("views.action_assignable.agent_section_title.default")
            %h4= agent_section_title
            .row{ style: 'margin-left: -9px; margin-right: -9px;' }
              - @petition.agents_random(2).each do |agent|
                .col-sm-4.col-xs-4{ style: 'padding-left: 6px; padding-right: 6px;' }
                  = render 'statementables/agent', agent: agent, statementable: @petition
              .col-sm-4.col-xs-4{ style: 'padding-left: 6px; padding-right: 6px;' }
                .panel.panel-default
                  .panel-body
                    = link_to petition_path(@petition, anchor: "anchor-agents"), class: "text-keep-all js-close-modal" do
                      다른 #{agent_section_title}
                      %i.fa.fa-arrow-right

  = content_for :script do
    :javascript
      $(function(){
        $('#sign-success-modal').modal('show');
      });
  - flash.delete(:sign_notice)

- if @petition.project
  = render 'projects/post_footer', project: @petition.project
